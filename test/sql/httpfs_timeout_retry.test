# name: test/sql/httpfs_timeout_retry.test
# description: test httpfs_timeout_retry extension
# group: [sql]

# Require statement will ensure this test is run with this extension loaded
require httpfs_timeout_retry

# Test that we can set and retrieve timeout settings (in milliseconds)
statement ok
SET httpfs_timeout_open = 45000;

query I
SELECT current_setting('httpfs_timeout_open');
----
45000

statement ok
SET httpfs_timeout_read = 90000;

query I
SELECT current_setting('httpfs_timeout_read');
----
90000

statement ok
SET httpfs_timeout_write = 120000;

query I
SELECT current_setting('httpfs_timeout_write');
----
120000

statement ok
SET httpfs_timeout_list = 60000;

query I
SELECT current_setting('httpfs_timeout_list');
----
60000

statement ok
SET httpfs_timeout_delete = 45000;

query I
SELECT current_setting('httpfs_timeout_delete');
----
45000

statement ok
SET httpfs_timeout_connect = 15000;

query I
SELECT current_setting('httpfs_timeout_connect');
----
15000

# Test that we can set and retrieve retry settings for each operation
statement ok
SET httpfs_retries_open = 5;

query I
SELECT current_setting('httpfs_retries_open');
----
5

statement ok
SET httpfs_retries_read = 4;

query I
SELECT current_setting('httpfs_retries_read');
----
4

statement ok
SET httpfs_retries_write = 6;

query I
SELECT current_setting('httpfs_retries_write');
----
6

statement ok
SET httpfs_retries_list = 3;

query I
SELECT current_setting('httpfs_retries_list');
----
3

statement ok
SET httpfs_retries_delete = 2;

query I
SELECT current_setting('httpfs_retries_delete');
----
2

statement ok
SET httpfs_retries_connect = 5;

query I
SELECT current_setting('httpfs_retries_connect');
----
5

statement ok
SET httpfs_retry_wait_ms = 200;

query I
SELECT current_setting('httpfs_retry_wait_ms');
----
200

statement ok
SET httpfs_retry_backoff = 5.0;

query I
SELECT current_setting('httpfs_retry_backoff');
----
5.0

statement ok
SET httpfs_retry_on_timeout = true;

query I
SELECT current_setting('httpfs_retry_on_timeout');
----
true

statement ok
SET httpfs_retry_on_connection_error = false;

query I
SELECT current_setting('httpfs_retry_on_connection_error');
----
false

# Test default values
statement ok
RESET httpfs_timeout_open;

query I
SELECT current_setting('httpfs_timeout_open');
----
30000

statement ok
RESET httpfs_timeout_read;

query I
SELECT current_setting('httpfs_timeout_read');
----
30000

statement ok
RESET httpfs_timeout_write;

query I
SELECT current_setting('httpfs_timeout_write');
----
30000

statement ok
RESET httpfs_timeout_list;

query I
SELECT current_setting('httpfs_timeout_list');
----
30000

statement ok
RESET httpfs_timeout_delete;

query I
SELECT current_setting('httpfs_timeout_delete');
----
30000

statement ok
RESET httpfs_timeout_connect;

query I
SELECT current_setting('httpfs_timeout_connect');
----
30000

statement ok
RESET httpfs_retries_open;

query I
SELECT current_setting('httpfs_retries_open');
----
3

statement ok
RESET httpfs_retries_read;

query I
SELECT current_setting('httpfs_retries_read');
----
3

statement ok
RESET httpfs_retries_write;

query I
SELECT current_setting('httpfs_retries_write');
----
3

statement ok
RESET httpfs_retry_wait_ms;

query I
SELECT current_setting('httpfs_retry_wait_ms');
----
100

statement ok
RESET httpfs_retry_backoff;

query I
SELECT current_setting('httpfs_retry_backoff');
----
4.0

statement ok
RESET httpfs_retry_on_timeout;

query I
SELECT current_setting('httpfs_retry_on_timeout');
----
true
