# name: test/sql/extension_setting.test
# description: test httpfs_timeout_retry extension settings
# group: [sql]

# Require statement will ensure this test is run with this extension loaded
require httpfs_timeout_retry

# Test that we can set and retrieve timeout settings (in milliseconds)
statement ok
SET httpfs_timeout_file_operation_ms = 45000;

query I
SELECT current_setting('httpfs_timeout_file_operation_ms');
----
45000

statement ok
SET httpfs_timeout_list_ms = 60000;

query I
SELECT current_setting('httpfs_timeout_list_ms');
----
60000

statement ok
SET httpfs_timeout_delete_ms = 45000;

query I
SELECT current_setting('httpfs_timeout_delete_ms');
----
	45000

statement ok
SET httpfs_timeout_stat_ms = 50000;

query I
SELECT current_setting('httpfs_timeout_stat_ms');
----
50000

statement ok
SET httpfs_timeout_create_dir_ms = 55000;

query I
SELECT current_setting('httpfs_timeout_create_dir_ms');
----
55000

# Test that we can set and retrieve retry settings for each operation
statement ok
SET httpfs_retries_file_operation = 5;

query I
SELECT current_setting('httpfs_retries_file_operation');
----
5

statement ok
SET httpfs_retries_list = 3;

query I
SELECT current_setting('httpfs_retries_list');
----
3

statement ok
SET httpfs_retries_delete = 2;

query I
SELECT current_setting('httpfs_retries_delete');
----
2

statement ok
SET httpfs_retries_stat = 4;

query I
SELECT current_setting('httpfs_retries_stat');
----
4

statement ok
SET httpfs_retries_create_dir = 5;

query I
SELECT current_setting('httpfs_retries_create_dir');
----
5

# Test that RESET sets values to NULL (they will fallback to http_timeout/http_retries)
statement ok
RESET httpfs_timeout_file_operation_ms;

query T
SELECT current_setting('httpfs_timeout_file_operation_ms');
----
NULL

statement ok
RESET httpfs_timeout_list_ms;

query T
SELECT current_setting('httpfs_timeout_list_ms');
----
NULL

statement ok
RESET httpfs_retries_file_operation;

query T
SELECT current_setting('httpfs_retries_file_operation');
----
NULL

# Test fallback to http_timeout/http_retries
statement ok
SET http_timeout = 60;

statement ok
RESET httpfs_timeout_file_operation_ms;

query I
SELECT current_setting('http_timeout');
----
60

statement ok
SET http_retries = 5;

statement ok
RESET httpfs_retries_file_operation;

query I
SELECT current_setting('http_retries');
----
5
